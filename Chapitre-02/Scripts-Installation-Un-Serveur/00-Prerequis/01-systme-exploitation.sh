#!/bin/bash

if [ $USER != "root" ]; then
        echo "Le script doit être exécuté en tant qu'utilisateur: root"
        exit -1
fi

cd ~

apt-get install -y ssh sshpass pdsh ntp supervisor xrdp \
                   gdebi-core build-essential software-properties-common \
                   wget curl gdebi net-tools dirmngr apt-transport-https \
                   texlive-latex-base libxml2-dev  git git-core libtool \
                   automake uuid-dev g++ gcc-multilib libtool-bin cmake \
                   python3-pip python3-venv libcurl4-openssl-dev libssl-dev \
                   texlive cifs-utils smbclient tree screen mysql-server \
                   openjdk-8-jdk-headless maven r-base r-base-dev

systemctl stop ufw
systemctl disable ufw

cat << FIN_FICHIER >> /etc/ssh/ssh_config
UserKnownHostsFile=/dev/null
LogLevel=quiet
FIN_FICHIER

#-----------------------------------------------------------------------------------------------
# 8.1.2.	L'installation du Java
#-----------------------------------------------------------------------------------------------

cat << FIN_FICHIER > /etc/profile.d/java_dev.sh
#!/bin/bash
# Configuration Outils
export M2_HOME=/usr/share/maven
export MAVEN_HOME=/usr/share/maven
export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
export JRE_HOME=\$JAVA_HOME/jre
export MAVEN_OPTS="-Xmx4g -XX:ReservedCodeCacheSize=2g"
export PATH=\$M3_HOME/bin:\$SCALA_HOME/bin:\$JAVA_HOME/bin:\$PATH
FIN_FICHIER

#-----------------------------------------------------------------------------------------------
# 8.1.3.	L'installation du langage Python
#-----------------------------------------------------------------------------------------------

update-alternatives --install \
        /usr/bin/python python \
        /usr/bin/python3.8 1

pip3 install flask findspark spylon-kernel \
       pyhive pyhadoop ipython jupyter py4j koalas mlflow \
       bokeh plotly dask flask curl cython cytoolz \
       graphframes graphviz html5lib matplotlib nltk \
       numpy pandas pyarrow pycurl scikit-learn \
       scipy seaborn tensorflow keras kafka \
       catboost xgboost lightgbm

#-----------------------------------------------------------------------------------------------
# 8.1.4.	L'installation du langage R
#-----------------------------------------------------------------------------------------------

cat << FIN_FICHIER > inst.R
install.packages(c('knitr', 'rmarkdown', 'devtools',
    'testthat', 'tidyverse', 'googleVis', 'data.table',
    'broom', 'caret', 'caretEnsemble', 'survival','qpdf'),
    repos='https://cloud.r-project.org/')
q('yes')
FIN_FICHIER

R CMD BATCH inst.R inst.out
